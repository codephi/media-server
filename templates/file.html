{% extends "base.html" %}

{% block title %}{{ file_info.name }} - Media Serve{% endblock %}

{% block actions %}
<a href="/download/{{ encoded_path }}" class="btn btn-primary">
    üíæ Download
</a>
{% endblock %}

{% block content %}
<div class="file-page">
    <div class="file-info">
        <h2>{{ file_info.name }}</h2>
        <table class="info-table">
            <tr>
                <th>Tamanho:</th>
                <td>{{ formatted_size }}</td>
            </tr>
            <tr>
                <th>Modificado:</th>
                <td>{{ formatted_modified }}</td>
            </tr>
            <tr>
                <th>Tipo MIME:</th>
                <td>{{ mime_type }}</td>
            </tr>
        </table>
    </div>

    <div class="file-content">
        {% match media_kind %}
        {% when crate::models::media::MediaKind::Image %}
        <div class="image-viewer">
            <img id="viewer-image" src="/content/{{ encoded_path }}" alt="{{ file_info.name }}">
        </div>

        {% when crate::models::media::MediaKind::Video %}
        <div class="video-container">
            <div class="video-player">
                <video id="main-video" controls preload="metadata">
                    <source src="/content/{{ encoded_path }}" type="{{ mime_type }}">
                    Seu navegador n√£o suporta a reprodu√ß√£o de v√≠deo.
                </video>
            </div>
            <div id="video-thumbnails-bar" class="video-thumbnails-bar" style="display: none;">
                <div class="thumbnails-container">
                    <div class="thumbnails-scroll">
                        <!-- Miniaturas ser√£o carregadas dinamicamente aqui -->
                    </div>
                </div>
            </div>
        </div>

        {% when crate::models::media::MediaKind::Audio %}
        <div class="audio-player">
            <audio controls preload="metadata">
                <source src="/content/{{ encoded_path }}" type="{{ mime_type }}">
                Seu navegador n√£o suporta a reprodu√ß√£o de √°udio.
            </audio>
        </div>

        {% when crate::models::media::MediaKind::Pdf %}
        <div class="pdf-viewer">
            <iframe src="/content/{{ encoded_path }}" width="100%" height="600px"></iframe>
        </div>

        {% when crate::models::media::MediaKind::Text %}
        <div class="text-viewer">
            <iframe src="/content/{{ encoded_path }}" width="100%" height="600px"></iframe>
        </div>

        {% when _ %}
        <div class="file-preview">
            <img src="/static/icons/{{ media_kind.icon_name() }}" alt="File icon" class="large-icon">
            <p>Visualiza√ß√£o n√£o dispon√≠vel para este tipo de arquivo.</p>
        </div>
        {% endmatch %}
    </div>
</div>
{% endblock %}

{% block scripts %}
{% match media_kind %}
{% when crate::models::media::MediaKind::Image %}
<script src="/static/js/viewer.js"></script>
{% when crate::models::media::MediaKind::Video %}
<script>
    const videoPath = "{{ encoded_path }}";
</script>
<script src="/static/js/video-preview.js"></script>
{% when _ %}
{% endmatch %}
{% endblock %}